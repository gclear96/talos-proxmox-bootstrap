# Proxmox
proxmox_endpoint   = "https://10.0.0.2:8006/"
proxmox_insecure   = true
proxmox_api_token  = "terraform@pve!token=REDACTED" # or set PROXMOX_VE_API_TOKEN / use env vars

# Cluster basics
cluster_name       = "homelab"
# A stable Kubernetes API endpoint (VIP or DNS). For a home lab, a VIP (kube-vip) is common.
cluster_endpoint   = "https://192.168.1.250:6443"
cluster_vip_ip     = "192.168.1.250" # optional but recommended when using a VIP endpoint
cluster_vip_interface = "eth0"

# 3 nodes (controlplane + worker)
nodes = {
  talos-1 = { node_name = "pve1", vm_id = 201, ip = "192.168.1.201", install_disk = "/dev/sda", mac_address = "BC:24:11:00:00:01" }
  talos-2 = { node_name = "pve2", vm_id = 202, ip = "192.168.1.202", install_disk = "/dev/sda", mac_address = "BC:24:11:00:00:02" }
  talos-3 = { node_name = "pve3", vm_id = 203, ip = "192.168.1.203", install_disk = "/dev/sda", mac_address = "BC:24:11:00:00:03" }
}

# Node network configuration
# Recommended: use fixed MACs + DHCP reservations so Talos gets the intended IP from first boot.
#
# Optional: configure Talos to use static addressing after config apply:
node_network_mode        = "dhcp" # or "static"
node_network_prefix      = 24
node_network_gateway     = "192.168.1.1"     # required when node_network_mode="static"
node_network_nameservers = ["192.168.1.1"]   # required when node_network_mode="static"
node_network_mtu         = null

# VM sizing
vm_cores           = 2
vm_memory_mb       = 4096
vm_disk_gb         = 40
vm_datastore_id    = "local-lvm"
vm_efi_datastore_id = null # defaults to vm_datastore_id
vm_bridge          = "vmbr0"
vm_vlan_id         = null # e.g. 1

# Talos ISO
# Option A: download ISO into Proxmox (recommended for IaC)
talos_iso_url      = "https://example.com/talos-amd64.iso"
talos_iso_file_name = "talos-amd64.iso"
iso_datastore_id   = "local"
# Option B: point at an existing ISO in Proxmox storage
talos_iso_file_id  = "local:iso/talos-amd64.iso" # set this if you don't download via Terraform

# Talos install image (required)
# For Longhorn, build a custom installer image with system extensions (iscsi-tools, util-linux-tools).
talos_installer_image = "ghcr.io/siderolabs/installer:v1.8.0"
allow_scheduling_on_control_planes = true

# Argo CD + platform repo
platform_repo_url      = "https://github.com/YOUR_GH_USER/talos-platform.git"
platform_repo_username = null # optional (needed for private Forgejo over HTTPS)
platform_repo_password = null # optional (token/password); prefer env vars + TF_VAR_platform_repo_password
platform_repo_revision = "main"
platform_repo_path     = "clusters/homelab/bootstrap"
argocd_chart_version   = null # e.g. "9.1.7" (chart versions vary)

# Wait for kube-apiserver before installing Argo CD (avoid race on first bootstrap)
kube_apiserver_wait_timeout_seconds  = 300
kube_apiserver_wait_interval_seconds = 5
